<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>vb — Phase 01 Blueprint</title>

  <style>
    @import url("https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Syne:wght@400;600;700;800&display=swap");

    :root {
      --bg: #0d0d0f;
      --surface: #111114;
      --surface2: #151518;
      --border: #1e1e26;
      --accent: #00ff87;
      --accent2: #0ff;
      --accent3: #ff6b35;
      --text: #e8e8ed;
      --muted: #52526a;
      --mono: "JetBrains Mono", monospace;
      --sans: "Syne", sans-serif;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: var(--sans);
      padding: 60px 40px;
      line-height: 1.7;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
    }

    .header {
      border-bottom: 1px solid var(--border);
      padding-bottom: 40px;
      margin-bottom: 60px;
    }

    .tag {
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--accent3);
      border: 1px solid rgba(255, 107, 53, 0.3);
      padding: 4px 10px;
      display: inline-block;
      margin-bottom: 18px;
    }

    h1 {
      font-size: 48px;
      font-weight: 800;
      letter-spacing: -0.03em;
    }

    h1 span {
      color: var(--accent);
    }

    .sub {
      font-family: var(--mono);
      font-size: 12px;
      color: var(--muted);
      margin-top: 10px;
    }

    .section {
      margin-bottom: 60px;
    }

    .section-title {
      font-family: var(--mono);
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--accent);
      margin-bottom: 20px;
    }

    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 28px;
      margin-bottom: 20px;
    }

    .card h3 {
      font-size: 20px;
      margin-bottom: 14px;
    }

    .step-list {
      list-style: none;
    }

    .step {
      display: grid;
      grid-template-columns: 40px 1fr;
      gap: 12px;
      padding: 14px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.03);
      font-family: var(--mono);
      font-size: 12px;
    }

    .step:last-child {
      border-bottom: none;
    }

    .step-num {
      color: var(--accent);
      font-weight: 700;
    }

    .code-block {
      background: var(--surface2);
      border: 1px solid var(--border);
      padding: 20px;
      border-radius: 6px;
      font-family: var(--mono);
      font-size: 12px;
      margin-top: 15px;
      white-space: pre-wrap;
      line-height: 1.6;
    }

    .validate {
      margin-top: 20px;
      padding: 16px 20px;
      border-radius: 6px;
      border: 1px dashed rgba(0, 255, 135, 0.3);
      background: rgba(0, 255, 135, 0.03);
      font-family: var(--mono);
      font-size: 12px;
      color: #7effc5;
    }

    footer {
      margin-top: 80px;
      padding-top: 30px;
      border-top: 1px solid var(--border);
      font-family: var(--mono);
      font-size: 10px;
      color: var(--muted);
      display: flex;
      justify-content: space-between;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <div class="tag">Engineering Blueprint</div>
      <h1><span>vb</span> — Phase 01 · Core Infrastructure</h1>
      <div class="sub">
        CLI Skeleton · Vault Discovery · Index Engine Deterministic
        Infrastructure Layer
      </div>
    </div>

    <!-- EXECUTION ORDER -->
    <div class="section">
      <div class="section-title">Execution Order (Strict Sequence)</div>
      <div class="card">
        <h3>01 · Project Bootstrap</h3>
        <ul class="step-list">
          <li class="step">
            <div class="step-num">1.1</div>
            <div>
              Create Go module:
              <code>go mod init github.com/yourname/vb</code>
            </div>
          </li>
          <li class="step">
            <div class="step-num">1.2</div>
            <div>Install Cobra + Viper</div>
          </li>
          <li class="step">
            <div class="step-num">1.3</div>
            <div>Create directory structure:</div>
          </li>
        </ul>

        <div class="code-block">
          /cmd root.go init.go /internal config/ vault/ index/
        </div>
      </div>
    </div>

    <!-- INIT COMMAND -->
    <div class="section">
      <div class="card">
        <h3>02 · vb init Command</h3>

        <p style="margin-bottom: 15px; font-family: var(--mono); font-size: 12px; color: #aaa;">
          <strong style="color: var(--accent3);">Context:</strong> <code>.vb/</code> is a <strong>user-land runtime
            artifact</strong> — created by the user in their chosen knowledge base directory. It has no relation to the
          vb source code tree above. The compiled <code>vb</code> binary lives in the user's PATH (e.g.
          <code>/usr/local/bin/vb</code>); the vault lives wherever the user runs <code>vb init</code>.
        </p>

        <div class="code-block">
          Responsibilities: - Check if .vb/ already exists - If not: create
          .vb/ create .vb/config.toml create .vb/index.json (empty scaffold) -
          Print confirmation
        </div>

        <div class="code-block">
          config.toml default: knowledge_path = "." editor = "nano" theme = "dark"
          lint_on_save = false

          # knowledge_path = "." means topic folders live alongside .vb/
          # can be set to any absolute or relative path to decouple storage
        </div>
      </div>
    </div>

    <!-- VAULT RESOLUTION -->
    <div class="section">
      <div class="card">
        <h3>03 · Upward Vault Resolver</h3>

        <div class="code-block">
          Stage 1 — find vault marker:
          start_dir := current working directory
          loop:
          if ".vb/" exists in start_dir: break
          if start_dir == filesystem root: error: vault not initialized
          start_dir = parent(start_dir)

          Stage 2 — resolve knowledge path:
          cfg := parse(start_dir + "/.vb/config.toml")
          knowledge_path := resolve(start_dir, cfg.knowledge_path)
          # this may differ from start_dir if user set an absolute/relative path
          return vault_root: start_dir, topic_root: knowledge_path
        </div>

        <p style="
              margin-top: 15px;
              font-family: var(--mono);
              font-size: 12px;
              color: #aaa;
            ">
          Stage 1 must not depend on index layer. Stage 2 reads config only — no filesystem walk yet.
        </p>
      </div>
    </div>

    <!-- INDEX ENGINE -->
    <div class="section">
      <div class="card">
        <h3>04 · Index Engine</h3>

        <div class="code-block">
          Purpose: Generate deterministic topic lookup. index.json schema: {
          "topics": { "disk": "hardware/disk", "ssh": "networking/ssh" } }
        </div>

        <div class="code-block">
          Execution order:
          1. Resolve knowledge_path via Vault Resolver (Stage 2)
          2. Walk knowledge_path directory ← NOT the vault root
          3. Detect topic folders (leaf nodes with any .md files)
          4. Map topic name → path relative to knowledge_path
          5. Serialize to .vb/index.json

          # The index path values are relative to knowledge_path so the
          # index remains valid even if the vault root directory is moved.
        </div>
      </div>
    </div>

    <!-- VALIDATION -->
    <div class="section">
      <div class="card">
        <h3>Validation Checklist</h3>

        <div class="validate">
          ✔ Run vb init
          ✔ Confirm .vb/config.toml exists with knowledge_path = "."
          ✔ Confirm .vb/index.json exists (empty scaffold)
          ✔ Create hardware/disk/ manually
          ✔ Run vb reindex
          ✔ Confirm disk appears in index.json
          ✔ Confirm upward resolution works from nested directories
          ✔ Set knowledge_path to an external directory → reindex → confirm topics resolve from new path
        </div>
      </div>
    </div>

    <footer>
      <span>vb engineering blueprint</span>
      <span>phase 01 · deterministic infrastructure</span>
    </footer>
  </div>
</body>

</html>