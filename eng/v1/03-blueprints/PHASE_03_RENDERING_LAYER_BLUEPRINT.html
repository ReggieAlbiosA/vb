<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>vb — Phase 03 Rendering Layer Blueprint</title>

    <style>
      @import url("https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Syne:wght@400;600;700;800&display=swap");

      :root {
        --bg: #0d0d0f;
        --surface: #111114;
        --surface2: #151518;
        --border: #1e1e26;
        --accent: #00ff87;
        --accent2: #0ff;
        --accent3: #ff6b35;
        --text: #e8e8ed;
        --muted: #52526a;
        --mono: "JetBrains Mono", monospace;
        --sans: "Syne", sans-serif;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        background: var(--bg);
        color: var(--text);
        font-family: var(--sans);
        padding: 60px 40px;
        line-height: 1.7;
      }

      .container {
        max-width: 1000px;
        margin: 0 auto;
      }

      .header {
        border-bottom: 1px solid var(--border);
        padding-bottom: 40px;
        margin-bottom: 60px;
      }

      .tag {
        font-family: var(--mono);
        font-size: 10px;
        letter-spacing: 0.15em;
        text-transform: uppercase;
        color: var(--accent);
        border: 1px solid rgba(0, 255, 135, 0.3);
        padding: 4px 10px;
        display: inline-block;
        margin-bottom: 18px;
      }

      h1 {
        font-size: 48px;
        font-weight: 800;
        letter-spacing: -0.03em;
      }

      h1 span {
        color: var(--accent);
      }

      .sub {
        font-family: var(--mono);
        font-size: 12px;
        color: var(--muted);
        margin-top: 10px;
      }

      .section {
        margin-bottom: 60px;
      }

      .section-title {
        font-family: var(--mono);
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.15em;
        color: var(--accent);
        margin-bottom: 20px;
      }

      .card {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 6px;
        padding: 28px;
        margin-bottom: 20px;
      }

      .card h3 {
        font-size: 20px;
        margin-bottom: 14px;
      }

      .code-block {
        background: var(--surface2);
        border: 1px solid var(--border);
        padding: 20px;
        border-radius: 6px;
        font-family: var(--mono);
        font-size: 12px;
        margin-top: 15px;
        white-space: pre-wrap;
        line-height: 1.6;
      }

      .note {
        margin-top: 15px;
        padding: 14px 18px;
        border-radius: 6px;
        border: 1px dashed rgba(0, 255, 255, 0.4);
        background: rgba(0, 255, 255, 0.05);
        font-family: var(--mono);
        font-size: 12px;
        color: #9fffff;
      }

      .validate {
        margin-top: 20px;
        padding: 16px 20px;
        border-radius: 6px;
        border: 1px dashed rgba(0, 255, 135, 0.3);
        background: rgba(0, 255, 135, 0.03);
        font-family: var(--mono);
        font-size: 12px;
        color: #7effc5;
      }

      footer {
        margin-top: 80px;
        padding-top: 30px;
        border-top: 1px solid var(--border);
        font-family: var(--mono);
        font-size: 10px;
        color: var(--muted);
        display: flex;
        justify-content: space-between;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <div class="header">
        <div class="tag">Engineering Blueprint</div>
        <h1><span>vb</span> — Phase 03 · Rendering Layer</h1>
        <div class="sub">
          Output Abstraction · Markdown Parsing · Styled Terminal Rendering
          Resolution-Independent Presentation Layer
        </div>
      </div>

      <!-- ARCHITECTURE -->
      <div class="section">
        <div class="section-title">Package Structure</div>
        <div class="card">
          <div class="code-block">
            /internal /render renderer.go // interface definition terminal.go //
            Glamour adapter theme.go // Lip Gloss themes /markdown parser.go //
            Goldmark integration
          </div>
          <p
            style="
              margin-top: 15px;
              font-family: var(--mono);
              font-size: 12px;
              color: #aaa;
            "
          >
            Rendering layer must not import resolver. Input = resolved file
            path. Output = styled string.
          </p>
        </div>
      </div>

      <!-- FLOW -->
      <div class="section">
        <div class="section-title">Rendering Flow</div>
        <div class="card">
          <div class="code-block">
            Input: filePath string lens string Execution Order: 1. Read markdown
            file (raw bytes) 2. Parse markdown via Goldmark → AST 3. Convert AST
            → formatted markdown string 4. Pass string to terminal renderer
            (Glamour) 5. Apply lens-specific Lip Gloss theme 6. Return final
            styled output
          </div>
        </div>
      </div>

      <!-- GOLDMARK -->
      <div class="section">
        <div class="card">
          <h3>01 · Goldmark Parser</h3>

          <div class="code-block">
            func ParseMarkdown(input []byte) (string, error) { var buf
            bytes.Buffer md := goldmark.New() err := md.Convert(input, &buf) if
            err != nil { return "", err } return buf.String(), nil }
          </div>

          <div class="note">
            Parsing must be deterministic. No auto-modification of user content.
            No lint enforcement here.
          </div>
        </div>
      </div>

      <!-- GLAMOUR -->
      <div class="section">
        <div class="card">
          <h3>02 · Glamour Renderer</h3>

          <div class="code-block">
            func RenderTerminal(markdown string) (string, error) { renderer, err
            := glamour.NewTermRenderer( glamour.WithAutoStyle(), ) if err != nil
            { return "", err } return renderer.Render(markdown) }
          </div>

          <div class="note">
            Renderer must be isolated. Future GUI renderer must implement same
            interface.
          </div>
        </div>
      </div>

      <!-- LIP GLOSS -->
      <div class="section">
        <div class="card">
          <h3>03 · Lens-Aware Themes (Lip Gloss)</h3>

          <div class="code-block">
            func ApplyTheme(output string, lens string) string { switch lens {
            case "why": return WhyStyle.Render(output) case "arch": return
            ArchStyle.Render(output) case "cli-tools": return
            ToolsStyle.Render(output) default: return output } }
          </div>

          <div class="code-block">
            var WhyStyle = lipgloss.NewStyle(). Border(lipgloss.NormalBorder()).
            BorderForeground(lipgloss.Color("10")). Padding(1,2)
          </div>

          <div class="note">
            Theme layer must not modify content structure. Only style wrapper
            allowed.
          </div>
        </div>
      </div>

      <!-- ABSTRACTION -->
      <div class="section">
        <div class="section-title">Renderer Interface</div>
        <div class="card">
          <div class="code-block">
            type Renderer interface { Render(content string, lens string)
            (string, error) }
          </div>

          <p
            style="
              margin-top: 15px;
              font-family: var(--mono);
              font-size: 12px;
              color: #aaa;
            "
          >
            TerminalRenderer implements this. Future WebviewRenderer will
            implement same interface.
          </p>
        </div>
      </div>

      <!-- VALIDATION -->
      <div class="section">
        <div class="card">
          <h3>Validation Checklist</h3>

          <div class="validate">
            ✔ Query same file with different lens → visual style differs ✔
            Confirm output identical content before styling ✔ Confirm resolver
            logic untouched ✔ Confirm missing file still errors before rendering
            ✔ Confirm no filesystem lookup in render layer
          </div>
        </div>
      </div>

      <footer>
        <span>vb engineering blueprint</span>
        <span>phase 03 · rendering abstraction</span>
      </footer>
    </div>
  </body>
</html>
